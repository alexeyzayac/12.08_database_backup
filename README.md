# Домашнее задание к занятию 8 "`Резервное копирование баз данных`" - `Заяц Алексей`

### Инструкция по выполнению домашнего задания

   1. Сделайте `fork` данного репозитория к себе в Github и переименуйте его по названию или номеру занятия, например, https://github.com/имя-вашего-репозитория/git-hw или  https://github.com/имя-вашего-репозитория/7-1-ansible-hw).
   2. Выполните клонирование данного репозитория к себе на ПК с помощью команды `git clone`.
   3. Выполните домашнее задание и заполните у себя локально этот файл README.md:
      - впишите вверху название занятия и вашу фамилию и имя
      - в каждом задании добавьте решение в требуемом виде (текст/код/скриншоты/ссылка)
      - для корректного добавления скриншотов воспользуйтесь [инструкцией "Как вставить скриншот в шаблон с решением](https://github.com/netology-code/sys-pattern-homework/blob/main/screen-instruction.md)
      - при оформлении используйте возможности языка разметки md (коротко об этом можно посмотреть в [инструкции  по MarkDown](https://github.com/netology-code/sys-pattern-homework/blob/main/md-instruction.md))
   4. После завершения работы над домашним заданием сделайте коммит (`git commit -m "comment"`) и отправьте его на Github (`git push origin`);
   5. Для проверки домашнего задания преподавателем в личном кабинете прикрепите и отправьте ссылку на решение в виде md-файла в вашем Github.
   6. Любые вопросы по выполнению заданий спрашивайте в чате учебной группы и/или в разделе “Вопросы по заданию” в личном кабинете.
   
Желаем успехов в выполнении домашнего задания!

---

### Задание 1. Резервное копирование

### Кейс

Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования.

Необходимо описать, какие варианты резервного копирования подходят в случаях:

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.

1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.

*Приведите ответ в свободной форме.*

#### Решение:

1.1.1. Подойдёт **полное резервное копирование (Full backup)**. Делать один полный бэкап раз в сутки в удобное окно, к примеру ночью, в интервале от 01:00 до 05:00. Копирование выполнять физический через **rsync**, либо логический через **pg_dump** / **mysqldump** и копию хранить на другом сервере. Хранить все копии минумум за последнюю неделю.

1.1.2. Также **подойдёт инкрементные бэкапы (Incremental backup)**. Делать полную копию, один раз в неделю, затем выполняется резервное копирование только блоков данных, которые были изменены с момента последнего резервного задания, в периудом раз в один день, к примеру ночью, в интервале от 01:00 до 05:00.

1.2. Подойдёт **инкрементные бэкапы (Incremental backup)**. Делать полную копию, один раз в день, затем выполняется резервное копирование только блоков данных, которые были изменены с момента последнего резервного задания, с периудом каждые 60 минут.

1.3. Для этого потребуется **основная (master) база данных** и одна или несколько **реплик (standby)**, настроенная репликация данных, а также механизм **автоматического или ручного переключения (failover)**, позволяющий при отказе основной базы практически мгновенно продолжить работу на резервной.

---

### Задание 2. PostgreSQL

2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

2.1.* Возможно ли автоматизировать этот процесс? Если да, то как?

*Приведите ответ в свободной форме.*

#### Решение:

**Резервное копирование базы данных с помощью pg_dump:**

````bash
pg_dump -U user -d my_db -f /backup/my_db_backup.dump
````

**Восстановление базы данных с помощью pg_restore:**

````bash
pg_restore -U user -d my_db /backup/my_db_backup.dump
````

**Автоматизировать этот процесс** можно через задание в cron.d:

````bash
SHELL=/bin/bash
PATH=/usr/bin:/bin

0 4 * * * postgres pg_dump -U user -d my_db -f /backup/my_db_backup.dump
````

---

### Задание 3. MySQL

3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL.

3.1.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?

*Приведите ответ в свободной форме.*